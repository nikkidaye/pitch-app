{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nclass TokenStorage {\n  static storeToken(continuationToken, productId) {\n    if (TokenStorage.canStore) {\n      TokenStorage.sessionStorage.setItem(TokenStorage.getKeyName(productId), continuationToken);\n    }\n  }\n\n  static getStoredToken(productId) {\n    if (!TokenStorage.canStore) {\n      return null;\n    }\n\n    return TokenStorage.sessionStorage.getItem(TokenStorage.getKeyName(productId));\n  }\n\n  static initialize() {\n    if (TokenStorage.canStore) {\n      const flag = TokenStorage.sessionStorage.getItem(TokenStorage.initializedFlag); // Duplicated tab, cleaning up all stored keys\n\n      if (flag) {\n        this.clear();\n      }\n\n      TokenStorage.sessionStorage.setItem(TokenStorage.initializedFlag, 'true'); // When leaving page or refreshing\n\n      TokenStorage.window.addEventListener('unload', () => {\n        TokenStorage.sessionStorage.removeItem(TokenStorage.initializedFlag);\n      });\n    }\n  }\n\n  static clear() {\n    if (TokenStorage.canStore) {\n      let keyToDelete = [];\n\n      for (let i = 0; i < TokenStorage.sessionStorage.length; i++) {\n        const key = TokenStorage.sessionStorage.key(i);\n\n        if (key.startsWith(TokenStorage.tokenStoragePrefix)) {\n          keyToDelete.push(key);\n        }\n      }\n\n      keyToDelete.forEach(key => TokenStorage.sessionStorage.removeItem(key));\n      TokenStorage.sessionStorage.removeItem(TokenStorage.initializedFlag);\n    }\n  }\n\n  static getKeyName(productId) {\n    return \"\".concat(TokenStorage.tokenStoragePrefix).concat(productId);\n  }\n\n  static get canStore() {\n    return TokenStorage.sessionStorage && TokenStorage.window;\n  }\n\n}\n\nTokenStorage.initializedFlag = 'twilio_twilsock_token_storage';\nTokenStorage.tokenStoragePrefix = 'twilio_continuation_token_';\nTokenStorage.sessionStorage = global['sessionStorage'];\nTokenStorage.window = global['window'];\nexports.TokenStorage = TokenStorage;\nTokenStorage.initialize();","map":null,"metadata":{},"sourceType":"script"}